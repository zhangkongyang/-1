<table id="types_data"></table>

<script>
var statusObj =[{tid:0,tname:"不可用"},{tid:1,tname:"可用"}];
var types_editRow = undefined;
var types_op;
var types_flag;

var types_obj=$('#types_data').datagrid({    
    url:'../../type',
    queryParams:{op:"findAll"},
    fitColumns:true,
    loadMsg:'数据加载中,请稍后...',
    striped:true,
    sortName:"tno",
    remoteSort:false,
    singleSelect:true,
    columns:[[    
        {field:'tno',title:'类型编号',width:50,align:'center',sortable:true},    
        {field:'tname',title:'类型名称',width:100,align:'center',editor:{type:"text",options:{required:true}}},    
        {field:'pic',title:'类型图片',width:100,align:'center',formatter:function(val,row,index){
        	return "<img src='../../"+val+"' width='50px' height='50px'/>";
        },editor:{type:"text",options:{required:true}}},
        {field:'status',title:'类型状态',width:50,align:'center',formatter:function(val,row,index){
        	if(val ==0){
        		return "不可用";
        	}else{
        		return "可用";
        	}
        },editor:{type:"combobox",options:{required:true,valueField:"tid",textField:"tname",data:statusObj}}}    
    ]],
    
    toolbar:[{
    	text:"添加",
    	iconCls:'icon-add',
    	handler:function(){
    		types_op ="add";
    		types_flag = "添加";
    		
    		if(types_editRow == undefined){
    			types_obj.datagrid('insertRow',{index:0 , row:{}}); //插入一行
    			types_obj.datagrid('beginEdit',0); //开始编辑
    			types_editRow = 0;   			
    		}	
    	}
    },'-',{
        	text:"编辑",
        	iconCls:'icon-edit',
        	handler:function(){
        		types_op="update";
        		types_flag= "修改";
        		if(types_editRow != undefined){
        			return;
        		}
        		
        		var row = types_obj.datagrid("getSelected");
        		if(row == null){
        			$.messager.show({title:'温馨提示',msg:"请选择您要修改的商品类型信息...",timeout:2000,showType:'slide'});
        			return;
        		}
        		types_editRow = types_obj.datagrid("getRowIndex",row);

        		//开始编辑
        		types_obj.datagrid("beginEdit",types_editRow);       
        	}
    },'-',{
        	text:"保存",
        	iconCls:'icon-savle',
        	handler:function(){
        		if(types_editRow == undefined){
        			return;
        		}
        		//编辑结束
        		types_obj.datagrid("endEdit",types_editRow);
        		
        		//获取修改的内容
        		var row = types_obj.datagrid("getChanges")[0];
        		
        		row["op"] = types_op;   // row.op = types_op;
        		
        		//提交到后台
        		$.post("../../type",row,function(data){
        			data = parseInt($.trim(data));
        			if(data>0){
        				alert("刷新成功");
        				types_obj.datagrid("reload"); //刷新表格
        			}else{
        				alert("刷新失败");
        			}
        			row = null;
        			types_editRow = undefined;
        		},"text"); 
        }
    },'-',{	
        	text:"删除",
        	iconCls:'icon-remove',
        	handler:function(){
        		if(types_editRow !=undefined){
        			return;
        		}
        		var row = types_obj.datagrid("getSelected");
        		if(row == null){
        			$.messager.show({title:'温馨提示',msg:"请选择您要修改的商品类型信息...",timeout:2000,showType:'slide'});
        			return;
        		}
        		$.messager.confirm("确认提示","数据一旦删除将不能恢复，您确定要删除此数据吗？",function(rt){
        			if(!rt){
        				return;
        			}
        			$.post("../../type",{op:"delete",tno:row.tno},data=>{
        				if(data>0){
                			$.messager.show({title:'成功提示',msg:"商品类型删除成功...",timeout:2000,showType:'slide'});
            				types_obj.datagrid("reload"); //刷新表格
        				} else{
                			$.messager.alert('失败提示','商品类型删除失败...','error');
        				}
        				row = null;
        			});
        			
        			
        		})
        	}
    },'-',{	
    	text:"撤销",
    	iconCls:'icon-undo',
    	handler:function(){
    		types_obj.datagrid("rejectChanges");
    		types_editRow = undefined;
    	}
},]
});


</script>